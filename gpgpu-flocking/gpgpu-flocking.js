(()=>{"use strict";var t={854:(t,e,r)=>{r.d(e,{Z:()=>o});var i=r(352),n=r.n(i)()((function(t){return t[1]}));n.push([t.id,"body {\r\n  margin: 0;\r\n}\r\n#viewport {\r\n  width: 100vw;\r\n  height: 100vh;\r\n  display: block;\r\n}\r\n",""]);const o=n},352:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r=t(e);return e[2]?"@media ".concat(e[2]," {").concat(r,"}"):r})).join("")},e.i=function(t,r,i){"string"==typeof t&&(t=[[null,t,""]]);var n={};if(i)for(var o=0;o<this.length;o++){var a=this[o][0];null!=a&&(n[a]=!0)}for(var s=0;s<t.length;s++){var u=[].concat(t[s]);i&&n[u[0]]||(r&&(u[2]?u[2]="".concat(r," and ").concat(u[2]):u[2]=r),e.push(u))}},e}},701:(t,e,r)=>{var i,n=function(){var t={};return function(e){if(void 0===t[e]){var r=document.querySelector(e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}t[e]=r}return t[e]}}(),o=[];function a(t){for(var e=-1,r=0;r<o.length;r++)if(o[r].identifier===t){e=r;break}return e}function s(t,e){for(var r={},i=[],n=0;n<t.length;n++){var s=t[n],u=e.base?s[0]+e.base:s[0],c=r[u]||0,l="".concat(u," ").concat(c);r[u]=c+1;var h=a(l),f={css:s[1],media:s[2],sourceMap:s[3]};-1!==h?(o[h].references++,o[h].updater(f)):o.push({identifier:l,updater:m(f,e),references:1}),i.push(l)}return i}function u(t){var e=document.createElement("style"),i=t.attributes||{};if(void 0===i.nonce){var o=r.nc;o&&(i.nonce=o)}if(Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),"function"==typeof t.insert)t.insert(e);else{var a=n(t.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(e)}return e}var c,l=(c=[],function(t,e){return c[t]=e,c.filter(Boolean).join("\n")});function h(t,e,r,i){var n=r?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(t.styleSheet)t.styleSheet.cssText=l(e,n);else{var o=document.createTextNode(n),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(o,a[e]):t.appendChild(o)}}function f(t,e,r){var i=r.css,n=r.media,o=r.sourceMap;if(n?t.setAttribute("media",n):t.removeAttribute("media"),o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}var d=null,x=0;function m(t,e){var r,i,n;if(e.singleton){var o=x++;r=d||(d=u(e)),i=h.bind(null,r,o,!1),n=h.bind(null,r,o,!0)}else r=u(e),i=f.bind(null,r,e),n=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(r)};return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else n()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=(void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i));var r=s(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var i=0;i<r.length;i++){var n=a(r[i]);o[n].references--}for(var u=s(t,e),c=0;c<r.length;c++){var l=a(r[c]);0===o[l].references&&(o[l].updater(),o.splice(l,1))}r=u}}}}},e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={id:i,exports:{}};return t[i](n,n.exports,r),n.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t=r(701),e=r.n(t),i=r(854);e()(i.Z,{insert:"head",singleton:!1}),i.Z.locals;const n="attribute vec3 a_position;\r\nattribute vec2 a_textureCoord;\r\n\r\nvarying highp vec2 v_textureCoord;\r\n\r\nvoid main(){\r\n  gl_Position = vec4(a_position, 1.0);\r\n  v_textureCoord = a_textureCoord;\r\n}";function o(t,e,r){let i=t.createShader(e);if(t.shaderSource(i,r),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS))return i;throw"shader creation failed: "+t.getShaderInfoLog(i)}function a(t,e,r){let i=t.createProgram(),n=o(t,t.VERTEX_SHADER,e),a=o(t,t.FRAGMENT_SHADER,r);if(t.attachShader(i,n),t.attachShader(i,a),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS))return t.deleteShader(n),t.deleteShader(a),i;throw"program creation failed: "+t.getProgramInfoLog(i)}function s(t,e){let r=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),r}class u{constructor(t,e,r,i){this.gl=t,this.textureWidth=e,this.textureHeight=r,this.dt=i}createPositionProgram(t,e){let r,i=this.gl,o=this.getDefaultAttributeData(),u={program:null,attributes:{},uniforms:{},framebuffers:new Array(2),textures:new Array(2),buffer:s(i,o),index:0};return u.program=a(i,n,t),r=i.getAttribLocation(u.program,"a_position"),i.enableVertexAttribArray(r),u.attributes.positionLoc=r,r=i.getAttribLocation(u.program,"a_textureCoord"),i.enableVertexAttribArray(r),u.attributes.textureCoordLoc=r,r=i.getUniformLocation(u.program,"u_dt"),u.uniforms.dtLoc=r,r=i.getUniformLocation(u.program,"u_texturePosition"),u.uniforms.texturePositionLoc=r,r=i.getUniformLocation(u.program,"u_textureVelocity"),u.uniforms.textureVelocityLoc=r,this.createTexturesAndFramebuffers(u,e),this.positionProgram=u,u}createVelocityProgram(t,e){let r,i=this.gl,o=this.getDefaultAttributeData(),u={program:null,attributes:{},uniforms:{},framebuffers:new Array(2),textures:new Array(2),buffer:s(i,o),index:0};return u.program=a(i,n,t),r=i.getAttribLocation(u.program,"a_position"),i.enableVertexAttribArray(r),u.attributes.positionLoc=r,r=i.getAttribLocation(u.program,"a_textureCoord"),i.enableVertexAttribArray(r),u.attributes.textureCoordLoc=r,r=i.getUniformLocation(u.program,"u_dt"),u.uniforms.dtLoc=r,r=i.getUniformLocation(u.program,"u_texturePosition"),u.uniforms.texturePositionLoc=r,r=i.getUniformLocation(u.program,"u_textureVelocity"),u.uniforms.textureVelocityLoc=r,this.createTexturesAndFramebuffers(u,e),this.velocityProgram=u,u}run(){this.gl.viewport(0,0,this.textureWidth,this.textureHeight),this.runPosition(),this.runVelocity()}runPosition(){let t=this.gl,e=this.positionProgram;t.bindBuffer(t.ARRAY_BUFFER,e.buffer),t.useProgram(e.program),t.bindFramebuffer(t.FRAMEBUFFER,e.framebuffers[e.index]),e.index=(e.index+1)%2;let r=e.attributes;t.vertexAttribPointer(r.positionLoc,3,t.FLOAT,null,20,0),t.vertexAttribPointer(r.textureCoordLoc,2,t.FLOAT,null,20,12),t.uniform1f(e.uniforms.dtLoc,this.dt),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e.textures[e.index]),t.uniform1i(e.uniforms.texturePositionLoc,0);let i=this.velocityProgram;t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,i.textures[i.index]),t.uniform1i(e.uniforms.textureVelocityLoc,1),t.drawArrays(t.TRIANGLE_STRIP,0,4)}runVelocity(){let t=this.gl,e=this.velocityProgram;t.bindBuffer(t.ARRAY_BUFFER,e.buffer),t.useProgram(e.program),t.bindFramebuffer(t.FRAMEBUFFER,e.framebuffers[e.index]),e.index=(e.index+1)%2;let r=e.attributes;t.vertexAttribPointer(r.positionLoc,3,t.FLOAT,null,20,0),t.vertexAttribPointer(r.textureCoordLoc,2,t.FLOAT,null,20,12),t.uniform1f(e.uniforms.dtLoc,this.dt),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e.textures[e.index]),t.uniform1i(e.uniforms.textureVelocityLoc,0);let i=this.positionProgram;t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,i.textures[i.index]),t.uniform1i(e.uniforms.texturePositionLoc,1),t.drawArrays(t.TRIANGLE_STRIP,0,4)}createTexturesAndFramebuffers(t,e){let r=this.gl;t.textures[0]=this.createTexture(r.FLOAT,null),t.textures[1]=this.createTexture(r.FLOAT,e),t.framebuffers[0]=this.createFramebuffer(t.textures[0]),t.framebuffers[1]=this.createFramebuffer(t.textures[1])}createTexture(t,e){let r=this.gl,i=r.createTexture();r.bindTexture(r.TEXTURE_2D,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);let n=r.TEXTURE_2D,o=r.RGBA,a=r.RGBA;return r.texImage2D(n,0,o,this.textureWidth,this.textureHeight,0,a,t,e),r.bindTexture(r.TEXTURE_2D,null),i}createFramebuffer(t){let e=this.gl,r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r);let i=e.FRAMEBUFFER,n=e.COLOR_ATTACHMENT0,o=e.TEXTURE_2D;return e.framebufferTexture2D(i,n,o,t,0),r}getDefaultAttributeData(){return new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0])}readPositionTexture(t,e){return this.readTexture(t,e,this.positionProgram)}readVelocityTexture(t,e){return this.readTexture(t,e,this.velocityProgram)}readTexture(t,e,r){let i=this.gl,n=(r.index+1)%2;i.bindFramebuffer(i.FRAMEBUFFER,r.framebuffers[n]);let o=new Float32Array(4);return i.readPixels(t,e,1,1,i.RGBA,i.FLOAT,o),o}}class c{constructor(t,e,r,i){this.gl=t,this.camera=e,this.width=t.canvas.clientWidth,this.height=t.canvas.clientHeight,this.textureWidth=r,this.textureHeight=i,t.clearColor(.1,.1,.12,1)}setPostionAndVelocityProgram(t,e){this.positionProgram=t,this.velocityProgram=e}createVisualizationProgram(){let t=this.gl,e=this.getVisualizationAttributeData();this.attributes={},this.uniforms={},this.buffer=s(t,e),this.program=a(t,"attribute vec3 a_position;\r\nattribute vec2 a_reference;\r\n\r\nuniform mat4 u_viewProjectionMatrix;\r\nuniform sampler2D u_texturePosition;\r\nuniform sampler2D u_textureVelocity;\r\n\r\nmat3 lookAlongVectorMatrix(vec3 direction) {\r\n    vec3 up = vec3(0.0, 1.0, 0.0);\r\n    vec3 zAxis = normalize(direction);\r\n    vec3 xAxis = normalize(cross(zAxis, up));\r\n    vec3 yAxis = normalize(cross(xAxis, zAxis));\r\n\r\n    return mat3(xAxis, yAxis, zAxis);\r\n}\r\n\r\nvoid main() {\r\n    vec3 position = texture2D( u_texturePosition, a_reference ).xyz;\r\n    vec3 velocity = texture2D( u_textureVelocity, a_reference ).xyz;\r\n    \r\n    mat3 rotationMatrix = lookAlongVectorMatrix(velocity);\r\n    vec3 rotPosition =  rotationMatrix * a_position;\r\n\r\n    vec4 worldPosition = vec4(rotPosition + position, 1);\r\n    gl_Position = u_viewProjectionMatrix * worldPosition;\r\n}\r\n","void main() {\r\n  gl_FragColor = vec4( 0.6, 0.2, 0.2, 1. );\r\n}\r\n"),this.referenceLocation=t.getAttribLocation(this.program,"a_reference"),t.enableVertexAttribArray(this.referenceLocation),this.positionLocation=t.getAttribLocation(this.program,"a_position"),t.enableVertexAttribArray(this.positionLocation),this.viewProjectionMatrixLocation=t.getUniformLocation(this.program,"u_viewProjectionMatrix"),this.texturePositionLocation=t.getUniformLocation(this.program,"u_texturePosition"),this.textureVelocityLocation=t.getUniformLocation(this.program,"u_textureVelocity")}run(){this.runVisualization()}runVisualization(){let t,e=this.gl;this.resizeCanvas(),e.viewport(0,0,this.width,this.height),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.useProgram(this.program),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clear(e.COLOR_BUFFER_BIT),e.vertexAttribPointer(this.positionLocation,3,e.FLOAT,null,20,0),e.vertexAttribPointer(this.referenceLocation,2,e.FLOAT,null,20,12),this.camera.updateViewProjectionMatrix(),e.uniformMatrix4fv(this.viewProjectionMatrixLocation,!1,this.camera.viewProjectionMatrix),t=this.positionProgram,e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t.textures[t.index]),e.uniform1i(this.texturePositionLocation,0),t=this.velocityProgram,e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t.textures[t.index]),e.uniform1i(this.textureVelocityLocation,1),e.drawArrays(e.TRIANGLES,0,6*this.textureWidth*this.textureHeight)}resizeCanvas(){let t=this.gl.canvas;this.width=t.clientWidth,this.height=t.clientHeight,t.width==this.width&&t.height==this.height||(t.width=this.width,t.height=this.height,this.camera.createProjectionMatrix())}getVisualizationAttributeData(){let t=[];for(let e=0;e<this.textureWidth;e++)for(let r=0;r<this.textureHeight;r++){let i=e/this.textureHeight,n=r/this.textureHeight;t.push(0,0,.05),t.push(i,n),t.push(0,.025,-.05),t.push(i,n),t.push(0,-.025,-.05),t.push(i,n),t.push(0,0,.05),t.push(i,n),t.push(.025,0,-.05),t.push(i,n),t.push(-.025,0,-.05),t.push(i,n)}return new Float32Array(t)}}var l=1e-6,h="undefined"!=typeof Float32Array?Float32Array:Array;function f(){var t=new h(16);return h!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});class d{constructor(t,e,r,i,n,o){this.canvas=t.canvas,this.worldUp=[0,1,0],this.near=i,this.far=n,this.fov=o,this.viewMatrix=f(),this.projectionMatrix=f(),this.viewProjectionMatrix=f(),this.createViewMatrix(e,r,this.worldUp),this.createProjectionMatrix(),this.updateViewProjectionMatrix()}createProjectionMatrix(){let t=this.canvas.clientWidth/this.canvas.clientHeight;!function(t,e,r,i,n){var o,a=1/Math.tan(e/2);t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(o=1/(i-n),t[10]=(n+i)*o,t[14]=2*n*i*o):(t[10]=-1,t[14]=-2*i)}(this.projectionMatrix,this.fov,t,this.near,this.far)}createViewMatrix(t,e,r){var i,n,o,a,s,u,c,h,f,d,x,m,g,p,v,b,A,T,y,_,P,E,R;i=this.viewMatrix,o=e,a=r,v=(n=t)[0],b=n[1],A=n[2],T=a[0],y=a[1],_=a[2],P=o[0],E=o[1],R=o[2],Math.abs(v-P)<l&&Math.abs(b-E)<l&&Math.abs(A-R)<l?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(i):(x=v-P,m=b-E,g=A-R,s=y*(g*=p=1/Math.hypot(x,m,g))-_*(m*=p),u=_*(x*=p)-T*g,c=T*m-y*x,(p=Math.hypot(s,u,c))?(s*=p=1/p,u*=p,c*=p):(s=0,u=0,c=0),h=m*c-g*u,f=g*s-x*c,d=x*u-m*s,(p=Math.hypot(h,f,d))?(h*=p=1/p,f*=p,d*=p):(h=0,f=0,d=0),i[0]=s,i[1]=h,i[2]=x,i[3]=0,i[4]=u,i[5]=f,i[6]=m,i[7]=0,i[8]=c,i[9]=d,i[10]=g,i[11]=0,i[12]=-(s*v+u*b+c*A),i[13]=-(h*v+f*b+d*A),i[14]=-(x*v+m*b+g*A),i[15]=1)}updateViewProjectionMatrix(){return t=this.viewProjectionMatrix,e=this.projectionMatrix,r=this.viewMatrix,i=e[0],n=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],f=e[9],d=e[10],x=e[11],m=e[12],g=e[13],p=e[14],v=e[15],b=r[0],A=r[1],T=r[2],y=r[3],t[0]=b*i+A*s+T*h+y*m,t[1]=b*n+A*u+T*f+y*g,t[2]=b*o+A*c+T*d+y*p,t[3]=b*a+A*l+T*x+y*v,b=r[4],A=r[5],T=r[6],y=r[7],t[4]=b*i+A*s+T*h+y*m,t[5]=b*n+A*u+T*f+y*g,t[6]=b*o+A*c+T*d+y*p,t[7]=b*a+A*l+T*x+y*v,b=r[8],A=r[9],T=r[10],y=r[11],t[8]=b*i+A*s+T*h+y*m,t[9]=b*n+A*u+T*f+y*g,t[10]=b*o+A*c+T*d+y*p,t[11]=b*a+A*l+T*x+y*v,b=r[12],A=r[13],T=r[14],y=r[15],t[12]=b*i+A*s+T*h+y*m,t[13]=b*n+A*u+T*f+y*g,t[14]=b*o+A*c+T*d+y*p,t[15]=b*a+A*l+T*x+y*v,this.viewProjectionMatrix;var t,e,r,i,n,o,a,s,u,c,l,h,f,d,x,m,g,p,v,b,A,T,y}getForward(){return this.viewMatrix.slice(8,11)}getUp(){return this.viewMatrix.slice(4,7)}getLeft(){return this.viewMatrix.slice(0,3)}getPosition(){return this.viewMatrix.slice(12,15)}}!function(){let t=document.getElementById("viewport").getContext("webgl",{premultipliedAlpha:!1});t.getExtension("OES_texture_float"),t.getExtension("WEBGL_color_buffer_float");let e=90*Math.PI/360,r=new d(t,[-12,0,0],[0,0,0],1,2e3,e),i=new u(t,64,64,.01),n=new c(t,r,64,64),o=new Float32Array(16384),a=new Float32Array(16384);o=o.map((()=>Math.random()-.5)),a=a.map((()=>Math.random()-.5));let s=i.createPositionProgram("#ifdef GL_FRAGMENT_PRECISION_HIGH\r\nprecision highp float;\r\n#else\r\nprecision mediump float;\r\n#endif\r\n\r\nuniform float u_dt;\r\nuniform sampler2D u_texturePosition;\r\nuniform sampler2D u_textureVelocity;\r\nvarying vec2 v_textureCoord;\r\n\r\nvoid main()\t{\r\n    vec3 position = texture2D( u_texturePosition, v_textureCoord ).xyz;\r\n    vec3 velocity = texture2D( u_textureVelocity, v_textureCoord ).xyz;\r\n    gl_FragColor = vec4( position + velocity * u_dt, 1. );\r\n}",o),l=i.createVelocityProgram("#ifdef GL_FRAGMENT_PRECISION_HIGH\r\nprecision highp float;\r\n#else\r\nprecision mediump float;\r\n#endif\r\n\r\nuniform float u_dt;\r\nuniform sampler2D u_texturePosition;\r\nuniform sampler2D u_textureVelocity;\r\nvarying vec2 v_textureCoord;\r\n\r\nconst vec2 textureSize = vec2(64., 64.);\r\n\r\nconst float cohesionStrength = 0.6;\r\nconst float alignmentStrength = 1.2;\r\nconst float separationStrength = 0.7;\r\n\r\nconst float cohesionDistance = 6.;\r\nconst float alignmentDistance = 3.;\r\nconst float separationDistance = 1.5;\r\n\r\nconst float cohesionDistanceSquared = cohesionDistance * cohesionDistance;\r\nconst float alignmentDistanceSquared = alignmentDistance * alignmentDistance;\r\nconst float separationDistanceSquared = separationDistance * separationDistance;\r\n\r\nconst float speedLimit = 1.;\r\n\r\nconst float sphereRadius = 5.;\r\nconst float sphereRadiusSquared = sphereRadius * sphereRadius;\r\nconst float boundaryStrength = 0.5;\r\n\r\nvec3 sphereBoundary(vec3 position) {\r\n    float distSquared = dot( position, position );\r\n    if (distSquared > sphereRadiusSquared) {\r\n        float dist = sqrt(distSquared);\r\n        float coeff = (-boundaryStrength / dist) * (dist - sphereRadius);\r\n        return position * coeff;\r\n    }\r\n    return vec3(0., 0., 0.);\r\n}\r\n\r\nvoid main()\t{\r\n    vec3 position = texture2D( u_texturePosition, v_textureCoord ).xyz;\r\n    vec3 velocity = texture2D( u_textureVelocity, v_textureCoord ).xyz;\r\n    vec3 force;\r\n    vec3 avgPosition;\r\n    vec3 avgVelocity;\r\n    vec3 separation;\r\n    float cohesionCount = 0.;\r\n    float alignmentCount = 0.;\r\n    vec2 ref;\r\n\r\n    // boundary\r\n    force += sphereBoundary(position);\r\n\r\n    for ( float s = 0.5; s < textureSize.x; s++ ) {\r\n        for ( float t = 0.5; t < textureSize.y; t++ ) {\r\n            ref = vec2(s, t) / textureSize;\r\n            vec3 otherPos = texture2D( u_texturePosition, ref ).xyz;\r\n            vec3 toOther = otherPos - position;\r\n            float distSquared = dot(toOther, toOther);\r\n            if (position == otherPos) continue;\r\n\r\n            if (distSquared < separationDistanceSquared) {\r\n                // separation\r\n                float dist = sqrt(distSquared);\r\n                float coeff = (1. / dist) - (1. / separationDistance);\r\n                separation -= toOther * coeff;\r\n            } else if (distSquared < alignmentDistanceSquared) {\r\n                // alignment\r\n                avgVelocity += texture2D( u_textureVelocity, ref ).xyz;\r\n                alignmentCount += 1.;\r\n            } else if (distSquared < cohesionDistanceSquared) {\r\n                // cohesion\r\n                avgPosition += otherPos;\r\n                cohesionCount += 1.;\r\n            }\r\n        }\r\n    }\r\n    // cohesion\r\n    if (cohesionCount > 0.1) {\r\n        avgPosition /= cohesionCount;\r\n        avgPosition -= position;\r\n        force += avgPosition * cohesionStrength;\r\n    }\r\n    // alignment\r\n    if (alignmentCount > 0.1) {\r\n        avgVelocity /= alignmentCount;\r\n        avgVelocity -= velocity;\r\n        force += avgVelocity * alignmentStrength;\r\n    }\r\n    // separation\r\n    force += separation * separationStrength;\r\n\r\n    // update velocity\r\n    velocity += force * u_dt;\r\n    float speed = length(velocity);\r\n    velocity *= speedLimit / speed;\r\n    gl_FragColor = vec4(velocity, 1.);\r\n}",a);n.createVisualizationProgram(),n.setPostionAndVelocityProgram(s,l),requestAnimationFrame((function t(){i.run(),n.run(),requestAnimationFrame(t)}))}()})()})();